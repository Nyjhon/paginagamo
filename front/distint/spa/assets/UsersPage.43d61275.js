import{s as y,u as k,v as D,x as q,o as E,c as x,w as t,a as r,h as d,e as s,i as S,m as h,Q as u,g as p,k as n,l as g,p as f,t as U,j as C,f as V,ax as Q,n as I}from"./index.60323709.js";import{Q as A,a as m,b}from"./QTable.17c40189.js";import{Q as M}from"./QPage.f120dced.js";import{C as O}from"./ClosePopup.4a42d959.js";import{d as _}from"./date.ea5ee918.js";import{_ as R}from"./plugin-vue_export-helper.21dcd24c.js";import"./QList.9166df1a.js";import"./QChip.a8ddf73a.js";import"./selection.880541e6.js";import"./format.8ac60962.js";import"./use-fullscreen.ccad7cbe.js";var F=y({name:"QTr",props:{props:Object,noHover:Boolean},setup(i,{slots:e}){const c=k(()=>"q-tr"+(i.props===void 0||i.props.header===!0?"":" "+i.props.__trClass)+(i.noHover===!0?" q-tr--no-hover":""));return()=>D("tr",{class:c.value},q(e.default))}});const N={name:"UsersPage",data(){return{crearUser:{nombre:"",correo:"",carnet:"",celular:"",password:"",fechalimite:_.formatDate(Date.now(),"YYYY-MM-DD"),unit:"",tipo:""},editUser:{nombre:"",correo:"",carnet:"",celular:"",password:"",fechalimite:_.formatDate(Date.now(),"YYYY-MM-DD"),unitedit:"",tipoedit:""},dialog_del:!1,dialogedit:!1,dialoganuevouser:!1,titulo:"Lista de Usuarios",usuarios:[],units:[],units2:[],tipos:[{label:"NORMAL",codigo:"0"},{label:"ADMINISTRADOR DE USUARIOS",codigo:"1"}],data:[],columns:[{name:"name",align:"left",label:"NOMBRE",field:"name",sortable:!0},{name:"email",align:"left",label:"E-MAIL",field:"email",sortable:!0},{name:"carnet",align:"left",label:"Carnet",field:"carnet",sortable:!0},{name:"unidad",align:"left",label:"UNIDAD",field:"unidad",sortable:!0},{name:"fechalimite",align:"left",label:"FECHA L\xCDMITE",field:"fechalimite",sortable:!0},{name:"opcion",label:"OPCIONES",field:"action",sortable:!1}],filter:""}},created(){this.cargarUsuarios(),this.cargarUnits()},methods:{cargarUsuarios(){this.$api.get("listausers").then(i=>{console.log(i.data),this.data=i.data}).catch(i=>{console.error("Error al cargar usuarios:",i)})},editarUser(i){this.editUser=i.row,this.editUser.tipoedit=this.tipos.find(e=>e.codigo===i.row.tipo),this.editUser.unitedit=i.row.unit.nombre,this.dialogedit=!0},EditUsuario(){if(this.editUser.unitedit==""||this.editUser.unitedit==null)return this.$q.notify({message:"Debe seleccionar unidad",color:"red",icon:"error"}),!1;if(this.editUser.tipoedit==""||this.editUser.tipoedit==null)return this.$q.notify({message:"Debe seleccionar tipo de usuario",color:"red",icon:"error"}),!1;console.log(this.editUser),this.$api.post("editarusuario",{id:this.editUser.id,name:this.editUser.name,email:this.editUser.email,carnet:this.editUser.carnet,fechalimite:this.editUser.fechalimite,unit_id:this.editUser.unitedit.id,tipo:this.editUser.tipoedit.codigo}).then(i=>{this.cargarUsuarios(),this.$q.notify({message:"Editado Correctamente",color:"secondary",icon:"check_circle"}),this.dialogedit=!1}).catch(i=>{console.error("Error al editar el usuario:",i)})},cambiopass(i){this.$q.dialog({title:"CAMBIAR PASSWORD",message:"Ingresar nueva contrase\xF1a",prompt:{model:"",type:"password"},cancel:!0,persistent:!0}).onOk(e=>{this.$api.post("/cambiopassword/"+i.row.id,{password:e}).then(c=>{console.log(c.data),this.$q.notify({color:"green-4",textColor:"white",icon:"cloud_done",message:"Contrase\xF1a Modificada correctamente"})})}).onCancel(()=>{}).onDismiss(()=>{})},deletedUsuario(i){this.dato2=i.row,this.dialog_del=!0},onDel(){const i={id:this.dato2.id};this.$api.post("deleteduser",i).then(e=>{console.log(e.data),this.$q.notify({color:"green-4",textColor:"white",icon:"cloud_done",message:"Eliminado correctamente"}),this.dialog_del=!1,this.cargarUsuarios()}).catch(e=>{console.error("Error al asignar tipos:",e)})},cargarUnits(){this.$api.get("listaunits").then(i=>{this.units=[],i.data.forEach(e=>{e.label=e.nombre,this.units.push(e)}),this.units2=this.units}).catch(i=>{console.error("Error al cargar usuarios:",i)})},filterFn(i,e){if(i===""){e(()=>{this.units=this.units2});return}e(()=>{const c=i.toLowerCase();this.units=this.units2.filter(v=>v.label.toLowerCase().indexOf(c)>-1)})},CrearUsuario(){if(this.crearUser.unit==""||this.crearUser.unit==null)return this.$q.notify({message:"Debe seleccionar unidad",color:"red",icon:"error"}),!1;if(this.crearUser.tipo==""||this.crearUser.tipo==null)return this.$q.notify({message:"Debe seleccionar tipo de usuario",color:"red",icon:"error"}),!1;this.$api.post("crearusuario",{name:this.crearUser.nombre,email:this.crearUser.correo,carnet:this.crearUser.carnet,password:this.crearUser.password,fechalimite:this.crearUser.fechalimite,unit_id:this.crearUser.unit.id,tipo:this.crearUser.tipo.codigo}).then(i=>{this.cargarUsuarios(),this.$q.notify({message:"Usuario Creado",color:"secondary",icon:"check_circle"}),this.dialoganuevouser=!1}).catch(i=>{console.error("Error al crear el usuario:",i)})}}},B={class:"row full-width"},L={class:"col-2 flex flex-center"},T={class:"row"},Y={class:"col-12"},P={class:"col-6"},z={class:"col-6"},G={class:"col-6"},H={class:"col-6"},j={class:"col-6"},W={class:"row"},J={class:"col-12"},K={class:"col-6"},X={class:"col-6"},Z={class:"row"},$={class:"col-6"},ee={class:"col-6"};function le(i,e,c,v,o,a){return E(),x(M,{class:"q-pa-md"},{default:t(()=>[r(p,null,{default:t(()=>[r(d,{class:"q-pa-none",style:{"background-color":"#b28f00"}},{default:t(()=>e[22]||(e[22]=[s("div",{class:"text-h6 text-center q-pa-none text-white"},"M\xF3dulo de Usuarios",-1)])),_:1}),r(S),r(h,null,{default:t(()=>[s("div",B,[s("div",L,[r(u,{onClick:e[0]||(e[0]=l=>o.dialoganuevouser=!0),color:"primary",icon:"person_add",label:"A\xF1adir usuario"})])])]),_:1})]),_:1}),r(p,null,{default:t(()=>[r(d,null,{default:t(()=>[r(A,{filter:o.filter,title:"REGISTRO DE USUARIOS",rows:o.data,dense:"",columns:o.columns,"row-key":"name","rows-per-page-options":[10,100,200,0]},{"top-right":t(()=>[r(n,{outlined:"",dense:"",debounce:"300",modelValue:o.filter,"onUpdate:modelValue":e[1]||(e[1]=l=>o.filter=l),placeholder:"Buscar"},{append:t(()=>[r(g,{name:"search"})]),_:1},8,["modelValue"])]),body:t(l=>[r(F,{props:l},{default:t(()=>[r(m,{key:"name",props:l},{default:t(()=>[f(U(l.row.name),1)]),_:2},1032,["props"]),r(m,{key:"email",props:l},{default:t(()=>[f(U(l.row.email),1)]),_:2},1032,["props"]),r(m,{key:"carnet",props:l},{default:t(()=>[f(U(l.row.carnet),1)]),_:2},1032,["props"]),r(m,{key:"unidad",props:l},{default:t(()=>[f(U(l.row.unit.nombre),1)]),_:2},1032,["props"]),r(m,{key:"fechalimite",props:l},{default:t(()=>[f(U(l.row.fechalimite),1)]),_:2},1032,["props"]),r(m,{key:"opcion",props:l},{default:t(()=>[r(g,{name:"edit",color:"secondary",size:"md",class:"cursor-pointer",onClick:w=>a.editarUser(l)},null,8,["onClick"]),r(g,{name:"vpn_key",color:"positive",size:"md",class:"cursor-pointer",onClick:w=>a.cambiopass(l)},null,8,["onClick"]),r(g,{name:"delete",color:"negative",size:"md",class:"cursor-pointer",onClick:w=>a.deletedUsuario(l)},null,8,["onClick"])]),_:2},1032,["props"])]),_:2},1032,["props"])]),_:1},8,["filter","rows","columns"])]),_:1})]),_:1}),r(V,{modelValue:o.dialoganuevouser,"onUpdate:modelValue":e[11]||(e[11]=l=>o.dialoganuevouser=l)},{default:t(()=>[r(p,{style:{width:"700px"}},{default:t(()=>[s("form",{onSubmit:e[10]||(e[10]=C((...l)=>a.CrearUsuario&&a.CrearUsuario(...l),["prevent"]))},[r(d,null,{default:t(()=>e[23]||(e[23]=[s("div",{class:"text-h6"},"Editar Informaci\xF3n",-1)])),_:1}),r(d,null,{default:t(()=>[s("div",T,[s("div",Y,[r(n,{modelValue:o.crearUser.nombre,"onUpdate:modelValue":e[2]||(e[2]=l=>o.crearUser.nombre=l),label:"Nombre Completo",class:"uppercase-input",required:""},null,8,["modelValue"]),r(n,{modelValue:o.crearUser.correo,"onUpdate:modelValue":e[3]||(e[3]=l=>o.crearUser.correo=l),type:"email",label:"Correo",required:""},null,8,["modelValue"])]),s("div",P,[r(n,{modelValue:o.crearUser.carnet,"onUpdate:modelValue":e[4]||(e[4]=l=>o.crearUser.carnet=l),label:"Carnet",type:"number",required:""},null,8,["modelValue"])]),s("div",z,[r(n,{modelValue:o.crearUser.password,"onUpdate:modelValue":e[5]||(e[5]=l=>o.crearUser.password=l),label:"Contrase\xF1a",type:"password",required:""},null,8,["modelValue"])]),s("div",G,[r(n,{modelValue:o.crearUser.fechalimite,"onUpdate:modelValue":e[6]||(e[6]=l=>o.crearUser.fechalimite=l),label:"Fecha Limite",type:"date",required:""},null,8,["modelValue"])]),s("div",H,[r(b,{filled:"",modelValue:o.crearUser.unit,"onUpdate:modelValue":e[7]||(e[7]=l=>o.crearUser.unit=l),label:"Seleccione Unidad",options:o.units,onFilter:a.filterFn,"use-input":"",clearable:""},null,8,["modelValue","options","onFilter"])]),s("div",j,[r(b,{options:o.tipos,modelValue:o.crearUser.tipo,"onUpdate:modelValue":e[8]||(e[8]=l=>o.crearUser.tipo=l),clearable:"","option-value":"codigo","option-label":"label",label:"Selecciona un tipo de usuario"},null,8,["options","modelValue"])])])]),_:1}),r(h,{align:"right"},{default:t(()=>[r(u,{flat:"",label:"Cancelar",color:"primary",onClick:e[9]||(e[9]=l=>o.dialoganuevouser=!1)}),r(u,{flat:"",label:"Guardar",color:"primary",type:"submit"})]),_:1})],32)]),_:1})]),_:1},8,["modelValue"]),r(V,{modelValue:o.dialogedit,"onUpdate:modelValue":e[20]||(e[20]=l=>o.dialogedit=l)},{default:t(()=>[r(p,{style:{width:"700px"}},{default:t(()=>[s("form",{onSubmit:e[19]||(e[19]=C((...l)=>a.EditUsuario&&a.EditUsuario(...l),["prevent"]))},[r(d,null,{default:t(()=>e[24]||(e[24]=[s("div",{class:"text-h6"},"Editar Informaci\xF3n",-1)])),_:1}),r(d,null,{default:t(()=>[s("div",W,[s("div",J,[r(n,{modelValue:o.editUser.name,"onUpdate:modelValue":e[12]||(e[12]=l=>o.editUser.name=l),label:"Nombre Completo",class:"uppercase-input",required:""},null,8,["modelValue"]),r(n,{modelValue:o.editUser.email,"onUpdate:modelValue":e[13]||(e[13]=l=>o.editUser.email=l),type:"email",label:"Correo",required:""},null,8,["modelValue"])]),s("div",K,[r(n,{modelValue:o.editUser.carnet,"onUpdate:modelValue":e[14]||(e[14]=l=>o.editUser.carnet=l),label:"Carnet",type:"number",required:""},null,8,["modelValue"])]),s("div",X,[r(n,{modelValue:o.editUser.fechalimite,"onUpdate:modelValue":e[15]||(e[15]=l=>o.editUser.fechalimite=l),label:"Fecha Limite",type:"date",required:""},null,8,["modelValue"])])]),s("div",Z,[s("div",$,[r(b,{filled:"",modelValue:o.editUser.unitedit,"onUpdate:modelValue":e[16]||(e[16]=l=>o.editUser.unitedit=l),label:"Seleccione Unidad",options:o.units,onFilter:a.filterFn,"use-input":"",clearable:""},null,8,["modelValue","options","onFilter"])]),s("div",ee,[r(b,{options:o.tipos,modelValue:o.editUser.tipoedit,"onUpdate:modelValue":e[17]||(e[17]=l=>o.editUser.tipoedit=l),clearable:"","option-value":"codigo","option-label":"label",label:"Selecciona un tipo de usuario"},null,8,["options","modelValue"])])])]),_:1}),r(h,{align:"right"},{default:t(()=>[r(u,{flat:"",label:"Cancelar",color:"primary",onClick:e[18]||(e[18]=l=>o.dialogedit=!1)}),r(u,{flat:"",label:"Guardar",color:"primary",type:"submit"})]),_:1})],32)]),_:1})]),_:1},8,["modelValue"]),r(V,{modelValue:o.dialog_del,"onUpdate:modelValue":e[21]||(e[21]=l=>o.dialog_del=l)},{default:t(()=>[r(p,null,{default:t(()=>[r(d,{class:"row items-center"},{default:t(()=>[r(Q,{icon:"clear",color:"red","text-color":"white"}),e[25]||(e[25]=s("span",{class:"q-ml-sm"},"Seguro de eliminar Registro.",-1))]),_:1}),r(h,{align:"right"},{default:t(()=>[r(u,{flat:"",label:"Eliminar",color:"deep-orange",onClick:a.onDel},null,8,["onClick"]),I(r(u,{flat:"",label:"Cancelar",color:"primary"},null,512),[[O]])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})}var pe=R(N,[["render",le],["__scopeId","data-v-1b1e9b2e"]]);export{pe as default};
